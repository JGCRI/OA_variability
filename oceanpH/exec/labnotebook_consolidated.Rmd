---
title: "Consolidated Lab Notebook Ocean pH"
author: "K. Dorheim"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: 
  html_document:
    toc: TRUE
    toc_float:
      collapsed: true
      toc_depth : 4
---

```{r set up lab note book environment, echo = FALSE, warning = FALSE}
# Control whether or not the intermediate images are saved permanently or not 
# knitr::opts_chunk$set(fig.path = "images_consolidated_labnotebook/")

library(knitr)
library(ggplot2)

BASE <- "C:/Users/dorh012/Documents/GitHub/OA_variability/oceanpH/figs"
```

# House Keeping  
****

Hi Corinne, 

So I cleaned stuff up a bit and discarded the figures that were unhelpful. I have only included the NH Atlantic basin figures to keep things simple. 

* Section [rcp85 Figures] is a better look at the changes in the amplitude what is going on with the min and the max. 
* Section [rcp85 vs esmrcp85 Figures] compares the difference between the esm and rcp figures for each variable in the NH Atlantic basin. There largest difference between the experiments is seen in the fgco2, small differences are observed in CO3 and pH. Essentially no differences between the experiments is observed in the tos and tas. 



## Methodology 
****

None of the variables in question have depth information. 


1. CDO - Concatenate cmip netcdfs and convert to absolute time 
2. CDO - Get the field weighted mean via cdo 
3. R - Remove model with unrealistic or missing pH/CO3 observations 
4. R - Concatenate the all of the csv files created on pic into a single RData object
5. R - detrend the basin means using a 3rd degree polynomial (see GitHub issue # 11 for decision)
6. R - analyze data 

## Methods Lessons
***

1. Detrend the models to remove long term climate change signals and isolate the annual information
2. AMOX and other long term climate signals are modeled by the CMIP models and may be present in the detrended CMIP data (Cary found a paper about this).
3. If a year has less than 12 months of data then the seasonal amplitude for this year will be artificially low because the amplitude is not covering the full range of the year affecting distribution and mean statistics (see the old rcp85 figures that have no 12 month requirement). Therefore years with less than 12 observations must be removed before calculating the amplitude. For the CMIP analysis this is really only an issue at the start and end of model experiment runs. For the observational analysis this reduces the number of amplitudes we can calculate using the observational data sets. 


# Summary of What We Have Tried

***

This section contains a summary of what we tried and didn't like. The figures are excluded from the consolidated lab note book but may be found in the full monster lab note book. 


### CESM1-BGC

We hoped to use CESM1-BGC as our study or representative model, however looking at the model comparison figures, (see products of rcp85_figures.R especially comparing_multiple_models.rda) we found that CESM1-BGC has a relatively low annual seasonal amplitude compared with other models in most basins with the expectation of the Arctic where it has a drastically high seasonal amplitude for most variables. So we came to the conclusion that CESM1-BGC cannot be our study model.


### K and S  

*K and S*

We tried to look for patterns/clustering in the K and D historical vs future by basin / model / variable. There did not appear to be unique clustering in any of the figures created. 


*Delta K and S* 

We calculate the delta K an S for the annual distribution for seasonal amplitudes in the historical and future experiments for each model / basin. We hoped so see some sort of pattern in the delta K and S tables, however these tables are too large and hard to read. There is nothing significant that stands out. However we found that the delta K and S values are better visualized with box plots. Distributions/density plots can help collaborate the K and S values. However the density plots for multiple models are hard to read because of differences in models there often times ends up being a multimodal distribution. 


### Robustness 

*Amplitude*

We tried to quantify the similarity of seasonal amplitude of the models by calculating the percent of model observations that fall within a distribution (this method had been used previously in the) literature but no model was the clear winner. The HadGem models had the highest percentage of observations within the distribution (over 80%) in all basins / variables. We liked the robustness or sameness time series plots that contained the distinction cloud but it was hard to understand the bar plots or the summary percent tables for this statistic. 

*Timing*

Comparable to the amplitude analysis we tired to look at the similarity of when the annual max and min occurred and quantify this information in a heat map (geom tile). The multiple model heat maps were essentially trash, the models are too inconsistent with the timing of annual max and mins to pick up any sort of pattern or in some cases (tas and tos) there was too much consistency.  


### Observations 

We looked at observational data sets HOTS, ESTOC, BATS ect and compared it with CMIP observations in the same region. While the detrended data was comparable to one another most of the observational data sets did not have enough observations within a single year to calculate an amplitude. 


# rcp85 Figures
```{r, echo = F, warnings = F}
# Import all of the figures
figs <- get(load(list.files(file.path(BASE, "cmip", "rcp85"), "consolidated_labnotebook_figs", full.names = T)))
```

I think these are the figures we like the best, so I pulled out a story line for a single basin, arbitrarily I chose NH Atlantic. To see if this makes it clearer. 

## pH rcp85 
****

### 1. Delta K an S

```{r, echo = F, warnings = F, fig.width=7}
figs$delta$ph
```


### 2. NH Atlantic

Since the delta K and delta S are both negative for the pH amplitude in this basin we expect there to be less variability and a decrease in size of the amplitude in the amplitude time series. This is consistent with the 
first panel of the figure below where we see models generally decreasing in amplitude and the noise is decreasing.

Q: What is driving the decrease in seasonal amplitude? 
A: in figure A it seems that the change in amplitude is being driven by the long term increase in annual minimum. The long term increase in annual min (becoming less min is what is making the amplitude generally decrease). While the annual max fluctuates it does not seem to be affected by any long term trends. 

Figure B supports this conclusion, the min pH in rcp 85 is less than the historical min. 


##### A. Ampliude, Min, and Max Time Series

```{r, echo = F, warnings = F, fig.width=9}
gridExtra::grid.arrange(figs$time_series$ph$`NH Atlantic`)
```


##### B. Monthly Mean 

```{r, echo = F, warnings = F, fig.width=7}
figs$monthly_mean$ph$`NH Atlantic`
```


## co3 rcp85 
****

### 1. Delta K and S
```{r, echo = F, warnings = F, fig.width=7}
figs$delta$co3
```


### 2. NH Atlantic

In the co3 Delta K and S figure the NH Atlantic $\Delta$ K is negative (we expect extreme observations to decrease) and the $\Delta$ S is positive (the mean amplitude has shifted right aka we expect the magnitude of the amplitude to increase). 

Figure A is inconsistent with the $\Delta$ S observation, the magnitude of the seasonality decreases and increases in different models, the long term trend in the seasonal amplitude time series is not clear. However the annual min time series clearly shows that the min annual min is increasing in magnitude, which is also evident in figure B. Figure B also shows that the average annual max decreases, this was not clear in the max time series of figure A. 


#### A. Ampliude, Min, and Max Time Series

```{r, echo = F, warnings = F, fig.width=9}
gridExtra::grid.arrange(figs$time_series$co3$`NH Atlantic`)
```


#### B. Monthly Mean 

```{r, echo = F, warnings = F, fig.width=7}
figs$monthly_mean$co3$`NH Atlantic`
```


## tos rcp85 
****

### 1. Delta K an S
```{r, echo = F, warnings = F, fig.width=7}
figs$delta$tos
```


### 2. NH Atlantic

The $\Delta$ K and S for the NH Atlantic tos is centered around 0. Meaning that we expect little to no difference in the distributions of the tos in the historical and future time period. 

In figure A the seasonal amplitude time series we see that the seasonal magnitude increases almost exponentially. This is being driven by decrease in annual mins (becoming more minimum) and the increase in annual max (becoming more max). These changes are also clear in the monthly mean, where rcp 85 has larger average extremes in the future period compared to the historical period.


#### A. Ampliude, Min, and Max Time Series

```{r, echo = F, warnings = F, fig.width=9}
gridExtra::grid.arrange(figs$time_series$tos$`NH Atlantic`)
```


#### B. Monthly Mean 

```{r, echo = F, warnings = F, fig.width=7}
figs$monthly_mean$tos$`NH Atlantic`
```


## tas rcp85 
****

### 1. Delta K an S
```{r, echo = F, warnings = F, fig.width=7}
figs$delta$tas
```


### 2. NH Atlantic

So the NH Atlantic $\Delta$ K is centered around 0 and the $\Delta$ S is slightly positive. This means that we expect amplitude distribution has shifted more to the right towards larger amplitude values. 

The seasonal amplitude time series in figure A increases with time. It is unclear in figure A and B do not indicate any sore of long term change in the average min for tas, this contradict the min tos trend that decreases with time. The slight increase in tas seasonal amplitude is being driven by an increase in the annual max as seen in fig A and B. 


#### A. Ampliude, Min, and Max Time Series

```{r, echo = F, warnings = F, fig.width=9}
gridExtra::grid.arrange(figs$time_series$tas$`NH Atlantic`)
```


#### B. Monthly Mean 

```{r, echo = F, warnings = F, fig.width=7}
figs$monthly_mean$tas$`NH Atlantic`
```

## spco2 rcp85
****

### 1. Delta K an S
```{r, echo = F, warnings = F, fig.width=7}
figs$delta$spco2
```


### 2. NH Atlantic

In the NH Atlantic basin the negative $\Delta$ K and S mean that that the future distribution of spCO2 amplitude is less variable (fewer extreme observations) and more skewed towards the left in the future period than in the historical period. 

In figure A the annual amplitude exponentially increase with time and the annual min value decreases while and the annual max value increases. In other words we see such an extreme increase in seasonality because the minimum is becoming more minimum and the maximum value is becoming more maximum. Which is obvious in figure B. 

My question is why is the min spCO2 decreasing? Wouldn't we expect it to increase? With increasing CO2? What is going on with atmospheric CO2?? 


#### A. Ampliude, Min, and Max Time Series

```{r, echo = F, warnings = F, fig.width=9}
gridExtra::grid.arrange(figs$time_series$spco2$`NH Atlantic`)
```


#### B. Monthly Mean 

```{r, echo = F, warnings = F, fig.width=7}
figs$monthly_mean$spco2$`NH Atlantic`
``` 

## fgco2 rcp85 
****

### 1. Delta K an S
```{r, echo = F, warnings = F, fig.width=7}
figs$delta$fgco2
```

As expected the $\Delta$ K & S and time series are consistent with the spCO2 trends. We see a large increase in the seasonal amplitude caused by a decreasing annual min and an increasing annual max. 

### 2. NH Atlantic

#### A. Ampliude, Min, and Max Time Series

```{r, echo = F, warnings = F, fig.width=9}
gridExtra::grid.arrange(figs$time_series$fgco2$`NH Atlantic`)
```


#### B. Monthly Mean 

```{r, echo = F, warnings = F, fig.width=7}
figs$monthly_mean$fgco2$`NH Atlantic`
```
 
 

 
 


# rcp85 vs esmrcp85 Figures 
***

This section aims to look at the difference between the regular historical/rcp85 and the esmHistorical/esmrcp85. To make graphing easier I had to change the names a bit so for the rest of this section anything that is rcp is just anything with esm is the emissions driven experiment. 

I have the figures for the other basins but to keep it simple I only include the NH Atlantic basin. I also filtered the so that the experiments all contain the same number of models and observations to that we are comparing apples to apples.

```{r, echo = F, warnings = F}
# Import all of the figures
figs <- get(load(list.files(file.path(BASE, "cmip"), "esm_rcp_comparison.rda", full.names = T)))
```

## ph rcp85 vs esmrcp85 

Compare the annual average ph (fig A) and the monthly average ph (fig B) of the rcp and emissions driven experiments. 

The annual averages are clearly difference in fig A. The difference between the rcp and emissions driven experiments are more pronounced in the future than historical period. The differences between the experiments depends on basin, in some basins such  as the NH Pacific the differences are more pronounced.

### Figure A Annual Average
```{r, echo = FALSE, warnings = F, fig.width=9}
figs$ph$`NH Atlantic`$annual
```


### Figure B Monthly Average
```{r, echo = FALSE, warnings = F}
figs$ph$`NH Atlantic`$monthly
```


## co3 rcp85 vs esmrcp85 

Compare the annual average co3 (fig A) and the monthly average co3 (fig B) of the rcp and emissions driven experiments. 

The annual averages in figure A for the emissions and rcp experiments are different from one another but in the monthly average figure B this difference between the experiments is pretty small. 


### Annual Average Figure A
```{r, echo = FALSE, warnings = F, fig.width=9}
figs$co3$`NH Atlantic`$annual
```


### Monthly Average Figure B
```{r, echo = FALSE, warnings = F}
figs$co3$`NH Atlantic`$monthly
```
 
## tos rcp85 vs esmrcp85

Compare the annual average tos (fig A) and the monthly average tos (fig B) of the rcp and emissions driven experiments. 

Compared to the difference between the rcp and emissions experiments in ph and co3, the difference in averages between the tos experiments in tos is small. Look at figures figures A and B here and compare with the co3 figures A and B.


### Annual Average Figure A
```{r, echo = FALSE, warnings = F, fig.width=9}
figs$tos$`NH Atlantic`$annual
```


### Monthly Average Figure B
```{r, echo = FALSE, warnings = F}
figs$tos$`NH Atlantic`$monthly
```
 
  
## tas rcp85 vs esmrcp85

Compare the annual average tas (fig A) and the monthly average tas (fig B) of the rcp and emissions driven experiments. 

Like tos the difference between emissions and rcp experiments is fairly small for tas. I think this is true for other basins. 


### Annual Average Figure A
```{r, echo = FALSE, warnings = F, fig.width=9}
figs$tas$`NH Atlantic`$annual
```


### Monthly Average Figure B
```{r, echo = FALSE, warnings = F}
figs$tas$`NH Atlantic`$monthly
```
 
 
## fgco2 rcp85 vs esmrcp85 

Compare the annual average fgco2 (fig A) and the monthly average fgco2 (fig B) of the rcp and emissions driven experiments. 

Figure B shows the difference between the emissions and rcp experiments the best but looking at the y axis this magnitude is really really small so I am not sure what to think about this figure. 


### Annual Average Figure A
```{r, echo = FALSE, warnings = F, fig.width=9}
figs$fgco2$`NH Atlantic`$annual
```


### Monthly Average Figure B
```{r, echo = FALSE, warnings = F}
figs$fgco2$`NH Atlantic`$monthly
```
 
There the rcp did not have CO2 output and the emissions did not have spco2 output.  
 
##### End 
 
